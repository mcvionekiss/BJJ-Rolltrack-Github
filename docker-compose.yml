
# Simplified Docker Compose configuration for easier testing
# No need to specify alternate files - just use "docker-compose up"

services:
  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
    env_file: ".env.testing"
    container_name: bjj-backend
    ports:
      - "8000:8000"
    volumes:
      - ./backend/server:/app/backend/server
      - ./backend/manage.py:/app/backend/manage.py
      - ./backend/requirements.txt:/app/backend/requirements.txt
    
  frontend:
    build:
      context: .
      dockerfile: frontend/Dockerfile
    env_file: ".env.testing"
    container_name: bjj-frontend
    ports:
      - "3000:3000"
    environment:
      # Dynamic host configuration with fallback
      - REACT_APP_HOST=${REACT_APP_HOST:-localhost}
      # REACT_APP_API_URL will be derived from REACT_APP_HOST in config.js
      # Disable source maps to eliminate warnings from rrule library
      - GENERATE_SOURCEMAP=false
    volumes:
      - ./frontend:/app/frontend
      - /app/frontend/node_modules
    depends_on:
      - backend
    # Run in development mode for easier debugging
    command: npm start